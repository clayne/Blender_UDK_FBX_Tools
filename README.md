Blender -> UE 3/4 FBX Tools

Blender addon that adds an editor for custom vertex normals, and an exporter with some tweaks and optimizations specific to the Unreal engine.

The exporter can also calculate tangents and binormals on export, allowing you to take advantage of the xNormal - UDK synced workflow using Blender.



*Compatible with Blender v2.70+*


A lot of this readme is obselete for version 1.0.0


- Optional: You'll need Vrav's Transfer Vertex Normals addon for the new Transfer Normals option. It's available at:
http://blenderartists.org/forum/showthread.php?259554-Addon-EditNormals-Transfer-Vertex-Normals&s=33911f74a3f9a2250b1645e4cda304a8

--------------------------------------------------------------------------------

*Installation:*

- Copy the 'udk_fbx_tools' folder to your addons directory. 
- Find it in the Addon Manager in the 'Mesh' category as 'UE FBX Normals Tools' and enable it. 
- There should be a new tab named 'Normals Editor' under 'Shading / UVs' in your tools panel. 


-------------------------------------------------------------------------------

*Notes:*

- Normals can be applied to the mesh in Vertex Mode, but not in Poly Mode. Both modes support displaying normals as 3D lines.
  - The mesh's displayed normals will reset every time you enter Blender's Edit Mode, and can be reset by clicking _Apply to Mesh_ again.

*Export Time* 
Exporting Tangents can be pretty slow. I've sped the script up a lot since the initial release, but it can stil take some time on complex meshes.
Blender may hitch or freeze while exporting, but shouldn't crash.


*Editing Performance* 
I've tested this on meshes with between 6 and 60000 polys. On my mid-range system (Intel i5-2500 with 8GB of RAM and a Geforce 760),
real-time display of normals and my custom angle-based generation algorithm are slow on anything past 8000 or so polys, depending on the mesh's
density. Checking "Selected Only" in the display section of each tool helps, but will slow things down more as you approach higher counts.


*Tangents and Unreal Engine 4:*
The tangents generated by this addon looked OK in UE4 in my initial tests, but after some experiments with Mikk Tspace (which UE4 uses natively) it turns out that there is a slight difference in shading
compared to automatically generated tangents. For this reason, it looks like letting UE4 generate tangents is a better option than calculating them with addon.

==================================================================================

*Features:*

_Editor for Vertex Normals:_

- Manual editing per poly or vertex normals 
- Automatic generation with several presets for different scenarios 
  - presets: (More advanced presets for foliage/tree normals should be up soon) 
    - *Smooth* (Blender default) 
    - *Vector* 
    - *Bent* (facing away from 3d cursor by an adjustable ratio) 
    - *Ground Foliage* (selected ground based vertices point up, everything else bent from an offset point) 
    - *Custom* (similar to Blender's default normals with the ability to generate normals for selected faces as if they are disconnected) 
- Allows calculating normals for selected faces or the whole mesh 
- Normals can be displayed as lines for visual editing 
- copy/paste selected normals between meshes with identical vert locations (buggy/wip, but fixes modular mesh seams when it works) 
- Real-time in Edit Mode 


_Customized FBX Exporter:_

- Can calculate and export tangents and binormals 
- Can export custom normals from the included editor 
- Support to export normals generated by asdn's Recalc Vertex Normals addon 
- Unreal Engine 3/4-specific optimizations: 
  - root bone fix that removes the armature bone from the exported file 
    - root bone is now parented to the scene to stop weirdness with some software and UE physics 
    - this fix also allows mesh orientations to be exported without having to mess around with the axis settings 
  - tangents are pretty close to UDK 
- Exported meshes should now be fully compatible with nvidia's Apex Tools, xNormal and most other software that uses the FBX format 
  - (previous versions caused crashes on import for some software) 
- Exports animations for both UDK and UE4 properly now 
	

_Importer for Normals:_

- Allows importing normals from FBX files to the custom variable used in this editor. 
- Works with multiple meshes at the same time. 
- The meshes have to already exist in the scene and be identical to the ones in the file (same number of vertices and faces). 


---------------------------------------------------------------------------------------------

*Documentation:*


_*Main Panel:*_

*Export*
- Opens the export menu

*Import Normals*			
- Imports normals from an fbx file and copies them to the editor's custom normals variables for found objects 
- Becomes visible when a mesh is selected and the editor is in Per Poly Mode 

*Mesh Data:*
*Initialize Data* 			
- Creates new custom mesh data object for selected mesh

*Reset* 					
- Resets custom mesh data to default values

*Clear* 					
- Deletes custom mesh data

----------------------------------------------------------------------------------------

*Vertex Normals Editor:*

*To enable:*
- Go to the UDK FBX Tool panel, click Initialize


*Apply to Mesh*:
- Visible in Per Vetex mode only
- Applies currently stored custom normals to the mesh


*Mode Selector*
- Click Switch Mode to change between Per Poly and Vertex normal editing modes 
  - _Per Vertex_ mode allows the edited normals to be displayed on the mesh, but can't be split 
  - _Per Poly_ mode can only display custom normals as 3D lines, but allows for split normals 
- Enabling Convert on Switch will try to convert the current normals to the new mode 
  - Note: switching from per poly mode with any split normals will produce weird results 


*Automatic Generation:*

- Select a mode from the dropdown menu.

Overview of modes:

- *Smooth (Default)*
  - Generates Blender's default normals + copies to custom data  
- *'By Vector'* 
  - All normals point in the specified direction, defaults to Up 
- *Bent* 
  - Normals point away from 3d cursor location by an adjustable ratio
  - Good for tree foliage when used with 'Selected Only' 
- *Ground Foliage* 
  - Good for grass planes - normals on selected vertices point up, everything else away from 'Center Offset' 
    - Lowering the Center Offset's Z-value will lower the amount by which upper normals are bent, making the shading look less 'round' 
      - If 'Ignore Hidden' is set, you can hide parts of the mesh and generate only for visible faces  
      - This mode produces the best results with a two-sided mesh, but a 2-sided material will also benefit. 
- *Custom* 
  - Calculates normals based on face normals 
  - results are pretty close to Blender's default 
  - allows calculating normals for selected faces as if they are separate from the mesh 
 
Checking *Selected Only* will generate normals for selected faces (not enabled for Smooth mode). 
 
Checking *Set to Mesh* will apply the generated results to the mesh when finished. 


*Manual Edit:*

*Show* 
- Set the custom vector to the currently selected vertex's normals 

*in Poly Mode:* 
- Select a vertex or set of vertices on the same face 
- Set the face index in the textbox below the normal coordinate 
- Set the x,y,z, normal coordinate to whatever you want 
- Click *Set* 

*in Vertex Mode:* 
- Same steps as per-poly, but vert index is not used 

*Checking 'Real-Time' will change the normal as you change the coordinates in the box* 


*Transfer Normals:* 

NOTE: This is a work in progress feature and requires the locations of the selected vertices to be identical. 

*Copy* 
- copies selected vertex normals to buffer 
*Paste* 
- pastes buffered normals to vertices found at the same position 

This can be used to reduce seams on modular character meshes and copy sharp edges from identical meshes with edge splits. 


*Display:* 
- Options for drawing lines to represent the vertex normals (color, scale, selection only) 

----------------------------------------------------------------------------------------------

*Exporter:*

Altered export settings:

*Up/Forward Axis* 
- Allows flipping the mesh's matrix for 

*Normals* 
- Default 
  - Blender generates normals 
- From Editor 
  - Custom normals from the included Vertex Normals Editor 
- asdsn's Addon 
  - export normals from the Recalc Vertex Normals addon 

*Tangents + Binormals* 	- calculate and export tangents + 'binormals' for the mesh 



*Importer:*

*Selected Objects*		- Toggle importing normals for selected meshes or all meshes in the scene



=========================================================================================================
Reference for tangent space calculation:

Lengyel, Eric. “Computing Tangent Space Basis Vectors for an Arbitrary Mesh”. Terathon Software 3D Graphics Library, 2001. http://www.terathon.com/code/tangent.html



=========================================================================================================
Changelog: 

_(not counting the ridiculous amount of edits after each update)_


*1.0.0*

- removed redundant class for vertexn_meshdata list, switched to vert_data type
- moved import/export buttons to proper menus
- reorganized interface to decrease clutter
- fixed long-running typo of adsn's name :D

- *exporter*:
- updated export scaling to a more standard method (not using local scaling)
- minor changes to previous armature axis settings fix (cleaner)
- updated default export method to read normals from loops like the newer default exporter
- added the ability to export blender's default tangents/binormals
- refactored + optimized custom tangent calculation method
  - performance improvements for exporting custom tangents (should be much faster now)
- added the ability to pick the UV layer tangents are based on (1 layer max)
- added warning messages + fallbacks to prevent the exporter from stopping when it encounters a problem

- *editor*:
- added ability to use Vrav's Transfer Vertex Normals addon from editor
  - this replaces copy/paste functionality


*0.10.1*

- *exporter*:
- fixed scaling for static mesh exports, not working properly for armatures at the moment
- the exporter now detects the root bone of any parented armature, removing the need to manually enter root bone name
- fixed an export error that occured when exporting a mesh twice (the normals list was getting cleared if in vertex mode)
- *editor*:
- fixed Default auto-generation method


*0.10.0*

- replaced broken init file (Blender should recognize the addon again)
- added ability to switch between per-poly and vertex normals in editor
- added ability to apply normals to mesh (vertex mode only, no split normals)
- rewrote Custom auto-generation mode (much faster now, and less likely to produce bad results)
- added bending ratio to Bent auto-generation mode
- rewrote copy/paste functionality
- various fixes to armature export


*0.9.0*

- added importer for normals only
- *exporter:*
- more exporter performance improvements
- changed the way normals etc are exported
- removed vertex sorting stuff from normals export since it should all be handled by the editor now


*0.8.0*

- *exporter:*
- rewrote the armature bone fix to parent the root bone to the scene (the way the armature object was before)
  - exported files should now be compatible with nvidia apex tools and anything else that uses fbx
  - no more messing with UDK's imported mesh rotations
- changed the way axis settings are handled during export and set up separate axis options
- exporter speed improvements


*0.7.5*

- *editor:*
- fixed Custom (Angle-Based) auto-generation mode. It's slightly slower (as in, it can take about 5 min for a 3600 poly mesh), but should no longer produce weird results on complex meshes.
- fixed wrong vertex being selected while using manual edit (bad math)
- *exporter:*
- added check for UV layer before calculating tangents. If not found, the mesh is exported without tangents (default behavior)


*0.7.0*

- initial release